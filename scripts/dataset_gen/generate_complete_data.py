import blenderproc as bproc
"""
    Generate the completed dataset.
    input: ply and npz
    output: phrases, scene_pc, obj_pc, json(6D pose, scale), png without keyboard
    e.g.:
        phrase: "put the keyboard infront of the monitor"
        scene_pc: "a point cloud with out keyboard, meanwhile, the obj pc painted blue, the position of keyboard painted green, the other pc painted black.
        obj_pc: get the keyboard mesh path from json and then transfer to pc.
        json: 6D pose and scale
        png: generated by blenderproc
"""
from scripts.dataset_gen.mesh_scene_gen_json import generate_mesh_scene_all_texute_v2
from scripts.dataset_gen.mesh_scene_gen_mask_bproc import bproc_gen_mask
def generated_completed_dataset(ply_path, npz_path, parent_folder):
    """
    ply_path: str
    npz_path: str
    parent_folder: str
    output: a parent folder containing subfolder of each dataset
    """
    # 1. ply and npz to json
    _, scene_mesh_json_path = generate_mesh_scene_all_texute_v2(ply_path=ply_path, npz_path=npz_path)
    # 2. json to RGBD blenderproc #completed
    bproc_gen_mask(scene_mesh_json= scene_mesh_json_path, RGB_out_dir = parent_folder)

    # 3. json to text and select one phrase
    # 4. Adapted to the phrase, get incompleted mesh and RGBD
if __name__ == "__main__":
    ply_path = "dataset/TO_scene_ori/TO-crowd/ply/train/id15.ply"
    npz_path = "dataset/TO_scene_ori/TO-crowd/npz/train/id15.npz"
    parent_folder = "dataset/scene_RGBD_mask"
    generated_completed_dataset(ply_path=ply_path, npz_path=npz_path, parent_folder=parent_folder)